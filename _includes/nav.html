{% assign page_url_parts = page.url | split: '/' %}
{% assign page_url_parts_size = page_url_parts | size %}

<nav>
  <ul class="navigation-list">
    {% assign pages_list = site.html_pages | sort:"nav_order" %}
    {% for node in pages_list %}
      {% unless node.nav_exclude %}
        {% assign node_url_parts = node.url | split: '/' %}
        {% assign node_url_parts_size = node_url_parts | size %}
        {% if node_url_parts_size <= 2 %}
          <li class="navigation-list-item{% if node_url_parts[1] == page_url_parts[1] %} active{% endif %}">
            {% if node_url_parts_size == 2 and page_url_parts_size == 3 and node_url_parts[1] == page_url_parts[1] %}
              {% assign first_level_url = node.url | absolute_url %}
              {% assign first_level_title = node.title %}
            {% endif %}
            <a href="{{ node.url | absolute_url }}" class="navigation-list-link{% if node.url == page.url %} active{% endif %}">{{ node.title }}</a>
            {% if node_url_parts_size >= 2 %}
              <ul class="navigation-list-child-list">
                {% for child in pages_list %}
                  {% assign child_url_parts = child.url | split: '/' %}
                  {% assign child_url_parts_size = child_url_parts | size %}
                  {% if child_url_parts_size >= 3 and child_url_parts[1] == node_url_parts[1] %}
                    <li class="navigation-list-item{% if child_url_parts[1] == page_url_parts[1] %} active{% endif %}">
                      <a href="{{ child.url | absolute_url }}" class="navigation-list-link{% if child.url == page.url %} active{% endif %}">{{ child.title }}</a>
                    </li>
                  {% endif %}
                {% endfor %}
              </ul>
            {% endif %}
          </li>
        {% endif %}
      {% endunless %}
    {% endfor %}
  </ul>
</nav>
